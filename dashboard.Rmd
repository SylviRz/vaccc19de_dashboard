---
title: "COVID-19 Impfungsdaten des RKI"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    social: menu
---



```{r setup, include=FALSE}
library(flexdashboard)
library(vaccc19de)
library(tidyverse)
library(highcharter)

# vaccc19de::rki_extract_cumulative_data("data/RKI_COVID19_Impfquotenmonitoring_2020-12-30.xlsx", out_folder = "data")

source("utils.R")

rki_dat <- dir("data/", full.names = T) %>% 
  purrr::map_dfr(read_csv) %>% 
  mutate(day = lubridate::as_date(ts_datenstand))
# 
# mapdata <- get_data_from_map(download_map_data("https://code.highcharts.com/mapdata/countries/de/de-all.js")) %>%
#   rename(bundesland = name) #%>% 
#   left_join(latest_dat)

# mapdata %>% 
#   left_join(latest_dat)
```





Column {.tabset data-width=300}
-----------------------------------------------------------------------


### Karte (Absolute Zahlen) 

```{r}
latest_dat <- rki_dat %>% 
  dplyr::filter(day==max(day))

    
hcmap(
  "https://code.highcharts.com/mapdata/countries/de/de-all.js",
  data = latest_dat,
  value = "impfungen_kumulativ",
  joinBy = c("name", "bundesland"),
  name = "Impfungen",
  dataLabels = list(enabled = TRUE, format = "{point.name}")
) %>%
  hc_exporting(
    enabled = TRUE
) 


```

### Karte (% der Bevölkerung)

<!-- {data-width=600} -->
Column {.tabset .tabset-fade data-width=600}
-----------------------------------------------------------------------


### Zeitreihe (Absolute Zahlen)


```{r}
rki_dat %>% 
  hchart("line", hcaes(day, impfungen_kumulativ, group = bundesland)) %>%
  # Axis
  hc_yAxis(
    title = list(text = "Impfungen (kumulativ)")
  ) %>% 
  hc_xAxis(
    title = list(text = "Tag des Datenrelease")
    )  %>% 
  hc_credits(
    enabled = TRUE, text = "Quelle: Robert Koch-Institut",
    href = "https://www.rki.de/DE/Content/InfAZ/N/Neuartiges_Coronavirus/Daten/Impfquoten-Tab.html",
    style = list(fontSize = "12px")
  ) %>% 
    hc_exporting(
      enabled = TRUE
    )

```





### Zeitreihe (% der Bevölkerung)
 
<!-- Row -->
<!-- ----------------------------------------------------------------------- -->

<!-- ### Downloads per sec (last 5 min) {.value-box} -->

<!-- ```{r} -->
<!-- # downloadRate is a reactive expression that computes the download -->
<!-- # rate during this dashboard's lifetime. -->
<!-- startTime <- as.numeric(Sys.time()) -->
<!-- # downloadRate <- reactive({ -->
<!-- #   elapsed <- as.numeric(Sys.time()) - startTime -->
<!-- #   nrow(pkgData()) / min(maxAgeSecs, elapsed) -->
<!-- # }) -->
<!-- # Emit the download rate -->
<!-- # renderValueBox({ -->
<!--   # rate <- formatC(downloadRate(), digits = 1, format = "f") -->
<!--   valueBox( -->
<!--     value = 3434, -->
<!--     icon = "fa-syringe", -->
<!--     color = "primary" -->
<!--   ) -->
<!-- # }) -->
<!-- ``` -->
